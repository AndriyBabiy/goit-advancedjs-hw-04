{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport simpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst form = document.querySelector('.search-form');\nconst gallery = document.querySelector('.gallery');\nconst loadMoreButton = document.querySelector('.load-more');\nlet page = 1;\nlet totalPages = 0;\nlet query = '';\n\nloadMoreButton.hidden = true;\n\nform.addEventListener('submit', handlerImageSearch);\nloadMoreButton.addEventListener('click', handlerLoadMore);\n\nconst lightbox = new simpleLightbox('.gallery a');\n\nasync function handlerImageSearch(evt) {\n  evt.preventDefault();\n  gallery.innerHTML = '';\n  loadMoreButton.hidden = true;\n  gallery.classList.remove('grid-styling');\n\n  page = 1;\n  totalPages = 0;\n  query = evt.currentTarget.elements.searchQuery.value;\n\n  if (!query.trim().length) {\n    iziToastErrorPopup(\n      'Please insert something into the search bar to get images'\n    );\n    throw new Error('Error: No search query');\n  }\n\n  try {\n    populateImages(query);\n  } catch (err) {\n    console.error(err);\n  } finally {\n    form.reset();\n  }\n}\n\nasync function handlerLoadMore() {\n  loadMoreButton.hidden = true;\n\n  page += 1;\n\n  console.log(page);\n\n  try {\n    await populateImages(query, page);\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nasync function populateImages(query, page = 1) {\n  const data = await fetchImages(query, page);\n\n  totalPages = Math.ceil(data.totalHits / 40);\n\n  const images = data.hits;\n\n  if (images.length === 0) {\n    iziToastErrorPopup(\n      'Sorry, there are no images matching your search query. Please try again.'\n    );\n  } else {\n    if (page === 1) {\n      iziToastSuccessPopup(`Hooray! We found ${data.totalHits} images.`);\n    }\n\n    gallery.classList.add('grid-styling');\n\n    if (page != totalPages) {\n      loadMoreButton.disabled = false;\n      loadMoreButton.removeAttribute('style');\n      loadMoreButton.textContent = 'Load more';\n      loadMoreButton.hidden = false;\n    } else {\n      showEndOfSearchResults();\n    }\n\n    gallery.insertAdjacentHTML('beforeend', createImageBlockMarkup(images));\n    lightbox.refresh();\n  }\n}\n\nasync function fetchImages(query, page) {\n  const CORE_URL = 'https://pixabay.com/api/';\n  const API_KEY = '42185018-8d9cd3aefdae43a32ddab8929';\n\n  const params = new URLSearchParams({\n    key: API_KEY,\n    per_page: 40,\n    page: page,\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: 'true',\n  });\n\n  const response = await axios.get(`${CORE_URL}?${params}`);\n\n  if (!response.statusText === 'OK') {\n    throw new Error(response.statusText);\n  }\n\n  return await response.data;\n}\n\nfunction createImageBlockMarkup(arr) {\n  return arr\n    .map(\n      ({\n        largeImageURL,\n        webformatURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n      <a href=\"${largeImageURL}\">\n        <div class=\"photo-card\">\n          <img src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n          <div class=\"info\">\n              <p class=\"info-item\">\n                <b>Likes</b>\n                ${likes}\n              </p>\n              <p class=\"info-item\">\n              <b>Views</b>\n              ${views}\n            </p>\n              <p class=\"info-item\">\n                <b>Comments</b>\n                ${comments}\n              </p>\n              <p class=\"info-item\">\n                <b>Downloads</b>\n                ${downloads}\n              </p>\n          </div>\n        </div>\n      </a>\n    `\n    )\n    .join('');\n}\n\nfunction iziToastSuccessPopup(text) {\n  return iziToast.show({\n    message: `${text}`,\n    color: 'green',\n    position: 'topRight',\n    timeout: 3000,\n  });\n}\n\nfunction iziToastErrorPopup(text) {\n  gallery.insertAdjacentHTML(\n    'afterbegin',\n    `<div class='iziToastLocation' style='width: 60%'></div>`\n  );\n\n  return iziToast.show({\n    message: `${text}`,\n    color: 'grey',\n    target: '.iziToastLocation',\n    timeout: false,\n  });\n}\n\nfunction showEndOfSearchResults() {\n  loadMoreButton.hidden = false;\n  loadMoreButton.disabled = true;\n  loadMoreButton.setAttribute(\n    'style',\n    `\n      background: none;\n      color: inherit;\n      border: none;\n      padding: 0;\n      font: inherit;\n      cursor: default;\n      outline: inherit;\n  `\n  );\n  loadMoreButton.textContent =\n    \"We're sorry, but you've reached the end of search results.\";\n}\n"],"names":["form","gallery","loadMoreButton","page","totalPages","query","handlerImageSearch","handlerLoadMore","lightbox","simpleLightbox","evt","iziToastErrorPopup","populateImages","err","e","data","fetchImages","images","iziToastSuccessPopup","showEndOfSearchResults","createImageBlockMarkup","CORE_URL","API_KEY","params","response","axios","arr","largeImageURL","webformatURL","tags","likes","views","comments","downloads","text","iziToast"],"mappings":"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"}